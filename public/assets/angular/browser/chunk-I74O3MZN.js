import{a as f}from"./chunk-PHSYVHON.js";import{a as h,f as I}from"./chunk-QVSNJCSE.js";import{P as p,V as n,Y as r,Yb as l,i as m,q as i,u as a}from"./chunk-QYSCFILT.js";var c=e=>{let t={payload:{email:e.user.email,name:e.user.name,id:e.user.id,role:e.user.utype,image:e.user.image},accessToken:e.token};return console.log("obj",t),t},g=e=>({auth:e,cookieName:"CrCookie"});var s=class e{constructor(t){this._http=t}Login(t,o){return this._http.post(`${h.apiUrl}/login`,{email:t,password:o})}Refresh(t){return i({data:{accessToken:"some_acces_token",refreshToken:"some_refresh_token",payload:{id:"841fca92-eba8-48c8-8c96-92616554c590",email:"aa@gmail.com"},expiresIn:3600}})}GetUser(){}static \u0275fac=function(o){return new(o||e)(r(l))};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};var b=class e{constructor(t,o,u){this._api=t;this.toast=o;this.authState=u}_loginUrl="/auth/login";stateItem=new m(null);stateItem$=this.stateItem.asObservable();Login(t){return this._api.Login(t.email,t.password).pipe(a(o=>{console.log("response from login",o);let u=c(o);return this.authState.SaveSession(u)}),p(o=>this.SetLocalSession(o)))}RefreshToken(){return this._api.Refresh(this.authState.GetRefreshToken()).pipe(a(t=>{if(!t)throw new Error("Oh oh");let o=c(t.data);return this.authState.UpdateSession(o),o}),p(t=>this.SetLocalSession(t)))}SetLocalSession(t){let o=g(t);return localStorage.setItem("user",JSON.stringify(t)),i(t)}GetUser(){let t=JSON.parse(localStorage.getItem("user"));return t&&t.accessToken?t:null}Logout(){return this.authState.Logout(),i(!0)}static \u0275fac=function(o){return new(o||e)(r(s),r(I),r(f))};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};export{b as a};
