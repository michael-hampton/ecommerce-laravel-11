import{a as Oe}from"./chunk-QX54BXSW.js";import{a as Ne,b as Pe}from"./chunk-AKGPCPJK.js";import{a as Ue}from"./chunk-72ZV2RTL.js";import{a as je,b as Be}from"./chunk-TC2VSDNX.js";import{a as S}from"./chunk-GP456TAF.js";import{a as Ve}from"./chunk-6I7PN7HP.js";import{a as Ae,b as Re}from"./chunk-QYOQXKGA.js";import{a as Te}from"./chunk-HQV6Q54H.js";import{a as He,b as Ge,c as ze}from"./chunk-Z2N3KAJX.js";import{b as ve,c as Ce,e as Y,g as be,h as ye,j as h,l as xe,n as Se,q as we,s as Fe,t as Ee,u as ke,x as De,z as Me}from"./chunk-ZUXETJBN.js";import{a as x,b as Ie,c as Le,e as Z}from"./chunk-LOXVGAEK.js";import{a as k,c as $e}from"./chunk-QVSNJCSE.js";import{Ba as me,Ca as f,Gb as J,Ha as p,Hb as W,Jb as X,La as se,Ma as re,Ob as ge,P as V,Pa as n,Qa as a,R as ie,Ra as s,Sa as pe,Ta as ce,V as w,Va as y,W as G,Wa as v,Xa as d,Y as b,Yb as he,Z as L,_a as $,a as T,ab as de,b as I,bb as fe,c as ae,ca as _,cb as ue,d as O,da as g,eb as c,ec as oe,f as H,fb as _e,gb as A,la as le,mb as K,qa as U,sa as m,sb as F,t as ne,tb as E,vb as N,wa as z,ya as q,za as Q}from"./chunk-QYSCFILT.js";var P="categories",D=class t{constructor(i,e){this.baseHttpClient=i;this.httpClient=e}delete(i){return this.httpClient.delete(`${k.apiUrl}/${P}/${i}`)}toggleActive(i){return this.httpClient.delete(`${k.apiUrl}/${P}/${i}/active`)}create(i){return this.httpClient.post(`${k.apiUrl}/${P}`,this.baseHttpClient.getFormData(i))}update(i,e){return this.baseHttpClient.update(`${k.apiUrl}/${P}/${i}`,e)}getData(i){return this.httpClient.post(`${k.apiUrl}/${P}/search`,i)}static \u0275fac=function(e){return new(e||t)(b(Le),b(he))};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};var Je={data:{},filter:I(T({},Te),{sortBy:"name"})},R=class t extends Ve{constructor(e,r){super(Je);this._api=e;this._globalStore=r}data$=this.select(({data:e})=>e);vm$=this.select({data:this.data$,filter:this.filter$},{debounce:!0});delete=this.effect(H(ie(()=>this._globalStore.setLoading(!0)),V(e=>this._api.delete(e).pipe(x({next:r=>this._globalStore.setSuccess("Deleted successfully"),error:r=>this._globalStore.setError(S(r)),finalize:()=>this._globalStore.setLoading(!1)})))));makeActive(e){return this._api.toggleActive(e.id).pipe(x({next:r=>{e.active=e.active?0:1,this.patchState(o=>({data:I(T({},o.data),{data:o.data.data.map(l=>l.id===e.id?e:l)})})),this._globalStore.setSuccess("Saved successfully")},error:r=>this._globalStore.setError(S(r)),finalize:()=>this._globalStore.setLoading(!1)}))}loadData=this.effect(e=>e.pipe(ie(()=>this._globalStore.setLoading(!0)),V(r=>this._api.getData(r).pipe(x({next:o=>this.patchState({data:o}),error:o=>this._globalStore.setError(S(o)),complete:()=>this._globalStore.setLoading(!1)})))));static \u0275fac=function(r){return new(r||t)(b(D),b(Z))};static \u0275prov=w({token:t,factory:t.\u0275fac})};var We={imagePreview:"",currentFile:void 0,categories:[],children:[]},j=class t extends Ie{constructor(e,r,o){super(We);this._api=e;this._globalStore=r;this._lookupService=o}file$=this.select(e=>e.currentFile);image$=this.select(({imagePreview:e})=>e);children$=this.select(({children:e})=>e);vm$=this.select(e=>({imagePreview:e.imagePreview,categories:e.categories,children:e.children}));saveData=e=>{let C=e,{id:r}=C,o=ae(C,["id"]),l=r?this._api.update(r,e):this._api.create(o);return this._globalStore.setLoading(!0),l.pipe(x({next:u=>{this._globalStore.setSuccess("Saved successfully")},error:u=>{this._globalStore.setLoading(!1),this._globalStore.setError(S(u))},finalize:()=>this._globalStore.setLoading(!1)}))};selectFile(e){this.patchState({imagePreview:""});let r=e.target.files;if(r){let o=r.item(0);if(o){this.patchState({imagePreview:"",currentFile:o});let l=new FileReader;l.onload=C=>{this.patchState({imagePreview:C.target.result})},l.readAsDataURL(o)}}}getCategories=this.effect(H(V(e=>this._lookupService.getCategories().pipe(x({next:r=>{let o=r.filter(u=>u.parent_id===null||u.parent_id===0),l=r.filter(u=>u.parent_id!==null&&u.parent_id!==0),C=[];l.forEach(u=>{C[u.parent_id]||(C[u.parent_id]=[]),C[u.parent_id].push(u)}),console.log("formattedChildren",C),this.patchState({categories:o,children:C})},error:r=>this._globalStore.setError(S(r))})))));addImage=this.updater((e,r)=>({imagePreview:r}));static \u0275fac=function(r){return new(r||t)(b(D),b(Z),b(Ne))};static \u0275prov=w({token:t,factory:t.\u0275fac})};var Ze=["modal"];function et(t,i){if(t&1&&(n(0,"option",40),c(1),a()),t&2){let e=i.$implicit;p("value",e.id),m(),A(" ",e.name," ")}}function tt(t,i){if(t&1&&(n(0,"div",5)(1,"label",37),c(2,"Attributes"),a(),n(3,"select",38),f(4,et,2,2,"option",39),a(),s(5,"p",8),a()),t&2){let e=i.ngIf;m(4),p("ngForOf",e.attributes)}}function it(t,i){if(t&1&&(n(0,"div",41),s(1,"img",42),a()),t&2){let e=i.ngIf;m(),p("src",e,U)}}function rt(t,i){if(t&1){let e=y();n(0,"div",3)(1,"form",4)(2,"div",5)(3,"label",6),c(4,"Name"),a(),s(5,"input",7)(6,"p",8),a(),n(7,"div",5)(8,"label",9),c(9,"Slug"),a(),s(10,"input",10)(11,"p",8),a(),s(12,"app-category-selector",11),n(13,"div",12),s(14,"input",13),n(15,"label",14),c(16," Active "),a()(),n(17,"div",5)(18,"label",15),c(19,"Description"),a(),s(20,"input",16)(21,"p",8),a(),n(22,"div",5)(23,"label",17),c(24,"Meta Title"),a(),s(25,"input",18)(26,"p",8),a(),n(27,"div",5)(28,"label",19),c(29,"Meta Description"),a(),s(30,"input",20)(31,"p",8),a(),n(32,"div",5)(33,"label",21),c(34,"Meta Keywords"),a(),s(35,"input",22)(36,"p",8),a(),f(37,tt,6,1,"div",23),F(38,"async"),n(39,"div")(40,"label",24),c(41,"Upload Image"),a()(),n(42,"div",25),f(43,it,2,1,"div",26),F(44,"async"),n(45,"div",27)(46,"label",28)(47,"span",29),s(48,"i",30),a(),n(49,"span",31),c(50,"Drop your images here or select "),n(51,"span",32),c(52,"click to browse"),a()(),n(53,"input",33),v("change",function(o){_(e);let l=d(2);return g(l._store.selectFile(o))}),a()()()(),n(54,"div",34)(55,"button",35),v("click",function(){_(e);let o=d(2);return g(o.closeMe())}),c(56," Close "),a(),n(57,"button",36),v("click",function(){_(e);let o=d(2);return g(o.save())}),c(58),a()()()()}if(t&2){let e=d(2);m(),p("formGroup",e.form),m(11),p("disableGrandchildren",!0),m(25),p("ngIf",E(38,9,e.lookupVm$)),m(6),p("ngIf",E(44,11,e._store.image$)),m(14),se("btn ",e.saveButtonClass,""),p("disabled",e.saveButtonDisabled),m(),A(" ",e.saveButtonText," ")}}function ot(t,i){if(t&1&&(n(0,"div",1),f(1,rt,59,13,"div",2),a()),t&2){let e=d();m(),p("ngIf",e.form)}}var B=class t extends Ae{constructor(e){super();this.fb=e}content;form;_store=L(j);_lookupStore=L(Pe);lookupVm$=this._lookupStore.vm$;formVm$=this._store.vm$;input=le;ngOnInit(){this.initializeForm(),this._lookupStore.getAttributes(),this.formData?.id&&this.patchForm(),this.form?.controls.name.valueChanges.subscribe(e=>{this.stringToSlug(e)})}save(){return O(this,null,function*(){let e=yield ne(this._store.file$);if((e||this.formData?.image.length)&&this.form.controls.image.setErrors(null),this.form?.valid){let r={name:this.form.value.name,slug:this.form.value.slug,parent_id:this.form.value.parent_id,meta_title:this.form.value.meta_title??"",meta_description:this.form.value.meta_description??"",meta_keywords:this.form.value.meta_keywords??"",description:this.form.value.description??"",active:this.form.value.active===!0?1:0,attributes:this.form.value.attributes};e&&(r.image=e),this.form.value.id&&(r.id=this.form.value.id),console.log("model",r),this._store.saveData(r).subscribe(o=>{this.confirm()})}})}patchForm(){console.log("attributes",this.formData.attributes),this.form?.patchValue({id:this.formData.id,name:this.formData.name,slug:this.formData.slug,parent_id:this.formData.parent_id,meta_title:this.formData.meta_title??"",meta_description:this.formData.meta_description??"",meta_keywords:this.formData.meta_keywords??"",description:this.formData.description??"",active:this.formData.active,attributes:this.formData.attributes}),this._store.addImage(this.formData.image)}initializeForm(){this.form=this.fb.group({id:new h(null),name:new h("",[Y.required]),slug:new h("",[Y.required]),image:new h("",[Y.required]),parent_id:new h(""),meta_title:new h(""),meta_description:new h(""),meta_keywords:new h(""),description:new h(""),attributes:new h(""),active:new h(!0)})}stringToSlug(e){var r=e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-");this.form?.patchValue({slug:r})}static \u0275fac=function(r){return new(r||t)(z(De))};static \u0275cmp=q({type:t,selectors:[["app-form"]],viewQuery:function(r,o){if(r&1&&de(Ze,5),r&2){let l;fe(l=ue())&&(o.content=l.first)}},standalone:!1,features:[K([j]),me],decls:2,vars:3,consts:[["class","card p-3",4,"ngIf"],[1,"card","p-3"],["class","card-body",4,"ngIf"],[1,"card-body"],["admin-form","","method","POST","id","admin-form","enctype","multipart/form-data",3,"formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","placeholder","Name","formControlName","name",1,"form-control"],[1,"text-danger"],["for","slug",1,"form-label"],["type","text","id","slug","name","slug","placeholder","Slug","formControlName","slug",1,"form-control"],["formControlName","parent_id","label","Parent",3,"disableGrandchildren"],[1,"form-check","mb-3"],["type","checkbox","formControlName","active","id","flexCheckDefault",1,"form-check-input"],["for","flexCheckDefault",1,"form-check-label"],["for","description",1,"form-label"],["type","text","id","description","name","description","placeholder","Description","formControlName","description",1,"form-control"],["for","meta_title",1,"form-label"],["type","text","id","meta_title","name","meta_title","placeholder","Meta Title","formControlName","meta_title",1,"form-control"],["for","meta_description",1,"form-label"],["type","text","id","meta_description","name","meta_description","placeholder","Meta Description","formControlName","meta_description",1,"form-control"],["for","meta_keywords",1,"form-label"],["type","text","id","meta_keywords","name","meta_keywords","placeholder","Meta Keywords","formControlName","meta_keywords",1,"form-control"],["class","mb-3",4,"ngIf"],["for","exampleInputEmail1",1,"form-label"],[1,"upload-image","flex-grow"],["class","item","id","imgpreview",4,"ngIf"],["id","upload-file",1,"item","up-load"],["for","myFile",1,"uploadfile"],[1,"icon"],[1,"fa","fa-upload"],[1,"body-text"],[1,"tf-color"],["type","file","id","myFile","name","image","accept","image/*","formControlName","image",3,"change"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","submit",3,"click","disabled"],["for","attributes",1,"form-label"],["id","attributes","name","attributes","multiple","","formControlName","attributes",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["id","imgpreview",1,"item"],["alt","",1,"effect8",3,"src"]],template:function(r,o){r&1&&(f(0,ot,2,1,"div",0),F(1,"async")),r&2&&p("ngIf",E(1,1,o.formVm$))},dependencies:[J,W,je,Be,Oe,xe,Fe,ke,Ce,ve,Ee,be,ye,Se,we,X],styles:[".child-indented[_ngcontent-%COMP%]{padding-left:120px}"]})};function at(t,i){if(t&1&&(n(0,"div",12),s(1,"img",13),n(2,"div",14)(3,"a",15),c(4),a()()()),t&2){let e=i.item;m(),$("src",e.image,U),$("alt",e.name),m(3),_e(e.name)}}function nt(t,i){if(t&1&&(n(0,"div",17),c(1),n(2,"a",18),s(3,"i",19),a(),n(4,"a",20),s(5,"i",21),a()()),t&2){let e=i.$implicit;m(),A(" ",e.name," "),m(),$("id",e.id),m(2),$("id",e.id)}}function lt(t,i){if(t&1&&f(0,nt,6,3,"div",16),t&2){let e=i.item;p("ngForOf",e.subcategories)}}function mt(t,i){if(t&1){let e=y();n(0,"i",24),v("click",function(){_(e);let o=d().item,l=d(2);return g(l.makeActive(o))}),a()}}function st(t,i){if(t&1){let e=y();n(0,"i",25),v("click",function(){_(e);let o=d().item,l=d(2);return g(l.makeActive(o))}),a()}}function pt(t,i){if(t&1&&f(0,mt,1,0,"i",22)(1,st,1,0,"i",23),t&2){let e=i.item;re(e.active===!0?0:1)}}function ct(t,i){t&1&&c(0," Hide ")}function dt(t,i){t&1&&c(0,"Publish ")}function ft(t,i){if(t&1){let e=y();n(0,"div",26)(1,"button",27),s(2,"i",28),a(),n(3,"ul",29)(4,"li")(5,"a",30),v("click",function(){let o=_(e).item,l=d(2);return g(l.edit(o))}),s(6,"i",31),c(7," Edit "),a()(),n(8,"li")(9,"a",30),v("click",function(){let o=_(e).item,l=d(2);return g(l.makeActive(o))}),s(10,"i",32),f(11,ct,1,0)(12,dt,1,0),a()(),n(13,"li")(14,"a",33),v("click",function(){let o=_(e).item,l=d(2);return g(l.delete(o))}),s(15,"i",34),c(16," Delete "),a()()()()}if(t&2){let e=i.item;m(11),re(e.active?11:12)}}function ut(t,i){if(t&1){let e=y();pe(0),n(1,"app-table",4),v("addButton",function(o){_(e);let l=d();return g(l.add(o))})("reload",function(){_(e);let o=d();return g(o.reload())})("changePage",function(o){_(e);let l=d();return g(l.pageChanged(o))}),s(2,"data-table-column",5),n(3,"data-table-column",6),f(4,at,5,3,"ng-template",null,2,N),a(),s(6,"data-table-column",7)(7,"data-table-column",8),n(8,"data-table-column",9),f(9,lt,1,1,"ng-template",null,2,N),a(),n(11,"data-table-column",10),f(12,pt,2,1,"ng-template",null,2,N),a(),n(14,"data-table-column",11),f(15,ft,17,1,"ng-template",null,2,N),a()(),ce()}if(t&2){let e=i.ngIf;m(),p("indexColumn",!1)("sortBy",e.filter==null?null:e.filter.sortBy)("sortDir",e.filter==null?null:e.filter.sortDir)("searchText",e.filter==null?null:e.filter.searchText)("itemCount",e.data==null?null:e.data.total)("items",e.data==null?null:e.data.data)("page",e.filter==null?null:e.filter.page),m(),p("sortable",!0),m(),p("sortable",!0),m(3),p("sortable",!0),m(),p("sortable",!0),m(),p("sortable",!1),m(3),p("sortable",!1),m(3),p("sortable",!1)}}var ee=class t{constructor(i){this.modalService=i}_store=L(R);vm$=this._store.vm$;ngOnInit(){this._store.loadData(this._store.filter$)}delete=i=>O(this,null,function*(){this.modalService.openConfirmationModal({modalTitle:"Are you sure?",modalBody:"click confirm or close"}).subscribe(e=>{this._store.delete(i.id),this._store.reset()})});edit(i){this.modalService.openModal(B,i,{modalTitle:"Edit Category"}).subscribe(e=>{this.modalService.closeModal(),this._store.reset()})}add(i){this.modalService.openModal(B,null,{modalTitle:"Create Category"}).subscribe(e=>{this._store.reset()})}pageChanged(i){let e=[];e.push({column:"name",value:$e(i),operator:"like"}),i=I(T({},i),{searchFilters:e}),this._store.updateFilter(i)}reload(){this._store.reset()}makeActive(i){let e=i.active?"This will hide the category from the website, including the menu. Any products listed within the category will no longer be accessible":"This will show the category from the website including the menu. Any products listed within the category will become accessible",r=i.active?"Hide":"Publish";this.modalService.openConfirmationModal({modalTitle:"Are you sure?",modalBody:e,saveButtonLabel:r}).subscribe(o=>{this._store.makeActive(i).subscribe()})}static \u0275fac=function(e){return new(e||t)(z(Re))};static \u0275cmp=q({type:t,selectors:[["app-category-list"]],standalone:!1,features:[K([R])],decls:6,vars:3,consts:[["confirmationModal",""],["modal",""],["dataTableCell",""],[4,"ngIf"],["headerTitle","Categories",3,"addButton","reload","changePage","indexColumn","sortBy","sortDir","searchText","itemCount","items","page"],["header","#","property","id",3,"sortable"],["header","Name","property","name",3,"sortable"],["header","Slug","property","slug",3,"sortable"],["header","Products","property","products",3,"sortable"],["header","Subcategories","property","subcategories",3,"sortable"],["header","Active","property","active",3,"sortable"],["header","Action",3,"sortable"],[1,"d-flex","align-items-center","justify-content-between","me-3"],[1,"image",2,"width","100px",3,"src","alt"],[1,""],["href","#",1,"fw-bold"],["class","d-flex align-items-center justify-content-between",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","justify-content-between"],["data-url","#","href","#","target","_blank",1,"edit",3,"id"],[1,"fa","fa-eye"],["data-url","#","href","#","target","_blank",1,"delete",3,"id"],[1,"fa","fa-trash"],[1,"fa","fa-check",2,"cursor","pointer"],[1,"fa","fa-times-circle",2,"cursor","pointer"],[1,"fa","fa-check",2,"cursor","pointer",3,"click"],[1,"fa","fa-times-circle",2,"cursor","pointer",3,"click"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown","aria-expanded","false","aria-label","Settings",1,"btn","btn-icon","btn-ghost","rounded-circle"],[1,"fa-solid","fa-ellipsis-vertical",2,"font-size","22px"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0)",1,"dropdown-item",3,"click"],[1,"fa","fa-edit","opacity-75","me-2"],[1,"fa","fa-archive","opacity-75","me-2"],["href","javascript:void(0)",1,"dropdown-item","text-danger",3,"click"],[1,"fa","fa-trash","opacity-75","me-2"]],template:function(e,r){e&1&&(f(0,ut,17,14,"ng-container",3),F(1,"async"),s(2,"div",null,0)(4,"div",null,1)),e&2&&p("ngIf",E(1,1,r.vm$))},dependencies:[J,W,Ge,He,X],encapsulation:2})};var _t=[{path:"",component:ee}],te=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=Q({type:t});static \u0275inj=G({imports:[oe.forChild(_t),oe]})};var Qe=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=Q({type:t});static \u0275inj=G({imports:[ge,te,Ue,ze,Me]})};export{Qe as CategoriesModule};
