import{V as a,Y as n,a as r,cc as i,i as s}from"./chunk-QYSCFILT.js";var l=class o{constructor(e){this.router=e;let t=this._GetUser();this.CheckAuth(t)?this.SetState(t):this.Logout(!1)}stateItem=new s(null);stateItem$=this.stateItem.asObservable();get redirectUrl(){return localStorage.getItem("redirectUrl")}set redirectUrl(e){localStorage.setItem("redirectUrl",e)}SetState(e){return this.stateItem.next(e),this.stateItem$}UpdateState(e){let t=r(r({},this.stateItem.getValue()),e);return this.stateItem.next(t),this.stateItem$}RemoveState(){this.stateItem.next(null)}_SaveUser(e){localStorage.setItem("user",JSON.stringify(e))}_RemoveUser(){localStorage.removeItem("user")}_GetUser(){let e=JSON.parse(localStorage.getItem("user"));return e&&e.accessToken?e:null}_SetCookie(e){let t=encodeURIComponent("CrCookie")+"="+encodeURIComponent(JSON.stringify(e)),h=new Date(e.expiresAt);t+=";expires="+h.toUTCString(),t+=";path=/",t+=";samesite=lax",document.cookie=t}_DeleteCookie(){this._SetCookie({accessToken:"",expiresAt:0})}SaveSession(e){return e.accessToken?(this._SaveUser(e),this.SetState(e),e):(this._RemoveUser(),this.RemoveState(),null)}UpdateSession(e){let t=this._GetUser();t?(t.accessToken=e.accessToken,t.refreshToken=e.refreshToken,this._SaveUser(t),this.UpdateState(e)):(this._RemoveUser(),this.RemoveState())}CheckAuth(e){return!(!e||!e.accessToken||Date.now()>e.expiresAt)}Logout(e=!1){this.RemoveState(),this._RemoveUser(),e&&(alert("yes"),this.router.navigateByUrl("login"))}GetToken(){let e=this.stateItem.getValue();return this.CheckAuth(e)?e.accessToken:null}GetRefreshToken(){let e=this.stateItem.getValue();return this.CheckAuth(e)?e.refreshToken:null}static \u0275fac=function(t){return new(t||o)(n(i))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a};
