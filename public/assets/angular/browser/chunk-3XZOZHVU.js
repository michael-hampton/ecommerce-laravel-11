import{a as ze,c as Qe}from"./chunk-DZZTNLX6.js";import{b as Oe}from"./chunk-AKGPCPJK.js";import{a as qe}from"./chunk-72ZV2RTL.js";import{a as Pe,b as Ae}from"./chunk-TC2VSDNX.js";import{a as k}from"./chunk-GP456TAF.js";import{a as Ne}from"./chunk-6I7PN7HP.js";import{a as je,b as Be}from"./chunk-QYOQXKGA.js";import{a as ke}from"./chunk-HQV6Q54H.js";import{a as Ge,b as He,c as Ue}from"./chunk-Z2N3KAJX.js";import{c as Ce,d as be,e as f,g as xe,h as ye,j as _,l as Se,n as Fe,q as Ee,r as Te,s as Ie,t as we,u as De,x as Ve,z as Me}from"./chunk-ZUXETJBN.js";import{a as M,b as $e,c as Le,e as z}from"./chunk-LOXVGAEK.js";import{a as $,c as Re}from"./chunk-QVSNJCSE.js";import{Aa as le,Ba as se,Ca as p,Gb as H,Ha as l,Hb as q,Jb as U,La as me,Mb as ve,Ob as he,P as W,Pa as n,Qa as r,R as T,Ra as c,Sa as pe,Ta as ce,V as y,Va as w,W as B,Wa as b,Xa as d,Y as v,Yb as ge,Z as I,_a as de,a as j,ab as ue,b as O,bb as fe,c as ie,ca as h,cb as _e,d as oe,da as g,eb as m,ec as X,f as re,gb as C,ma as ne,mb as F,na as ae,sa as a,sb as D,tb as V,vb as G,wa as S,ya as P,za as A}from"./chunk-QYSCFILT.js";var Q="coupons",E=class i{constructor(t,e){this.baseHttpClient=t;this.httpClient=e}create(t){return this.httpClient.post(`${$.apiUrl}/${Q}`,t)}update(t,e){return this.httpClient.put(`${$.apiUrl}/${Q}/${t}`,e)}delete(t){return this.httpClient.delete(`${$.apiUrl}/${Q}/${t}`)}getData(t){return this.httpClient.post(`${$.apiUrl}/${Q}/search`,t)}static \u0275fac=function(e){return new(e||i)(v(Le),v(ge))};static \u0275prov=y({token:i,factory:i.\u0275fac,providedIn:"root"})};var Xe={data:{},filter:O(j({},ke),{sortBy:"code"})},N=class i extends Ne{constructor(e,o){super(Xe);this._api=e;this._globalStore=o}data$=this.select(({data:e})=>e);vm$=this.select({data:this.data$,filter:this.filter$},{debounce:!0});delete=this.effect(re(T(()=>this._globalStore.setLoading(!0)),W(e=>this._api.delete(e).pipe(M({next:o=>{this._globalStore.setSuccess("Deleted successfully")},error:o=>{this._globalStore.setLoading(!1),this._globalStore.setError(k(o))},finalize:()=>this._globalStore.setLoading(!1)})))));loadData=this.effect(e=>e.pipe(T(()=>this._globalStore.setLoading(!0)),W(o=>this._api.getData(o).pipe(M({next:s=>this.patchState({data:s}),error:s=>this._globalStore.setError(k(s)),complete:()=>this._globalStore.setLoading(!1)})))));static \u0275fac=function(o){return new(o||i)(v(E),v(z))};static \u0275prov=y({token:i,factory:i.\u0275fac})};var Ye={},L=class i extends $e{constructor(e,o){super(Ye);this._api=e;this._globalStore=o}saveData=e=>{let ee=e,{id:o}=ee,s=ie(ee,["id"]);return(o?this._api.update(o,e):this._api.create(s)).pipe(T(()=>this.patchState({loading:!0})),M({next:te=>{this._globalStore.setSuccess("Saved successfully")},error:te=>{this._globalStore.setLoading(!1),this._globalStore.setError(k(te))},finalize:()=>this._globalStore.setLoading(!1)}))};static \u0275fac=function(o){return new(o||i)(v(E),v(z))};static \u0275prov=y({token:i,factory:i.\u0275fac})};var Y=(e=>(e.fixed="Fixed",e.percent="Percent",e))(Y||{});var Ke=new Map([["phone","[+\\d\\s]*"],["password","[\\S]{8,}"],["positiveNumber",/^(0*[1-9][0-9]*(\.[0-9]*)?|0*\.[0-9]*[1-9][0-9]*)$/],["url","^(http|https)://[a-zA-Z0-9-.]+.[a-zA-Z]{2,3}(/S*)?$"],["image",".+\\.{1}(jpg|png|gif|bmp)$"]]);var Z=class i{constructor(t){this.el=t}min;max;minlength;maxlength;block;pattern;crpattern;email;validator;params;get element(){return this.el.nativeElement}errorText=ae("Required");validate(t){if(this.validator){let e=Qe.get(this.validator);e&&!t.hasValidator(e)&&(this.params?t.addValidators(e(this.params)):t.addValidators(e))}if(this.errorText.set("Required"),this.min&&t.value&&f.min(this.min)(t)&&this.errorText.set("Too small"),this.max&&t.value&&f.max(this.max)(t)&&this.errorText.set("Too large"),this.minlength&&t.value&&f.minLength(this.minlength)(t)&&this.errorText.set("Too short"),this.maxlength&&t.value&&f.maxLength(this.maxlength)(t)&&this.errorText.set("Too long"),this.block&&t.value>=this.block[0]&&t.value<=this.block[1])return this.errorText.set("Invalid number"),{block:!0};if(this.pattern&&this.errorText.set("Invalid format"),this.email&&this.errorText.set("Invalid email format"),this.crpattern){this.errorText.set("Invalid format");let e=Ke.get(this.crpattern);if(e)return this.errorText.set(`Invalid ${this.crpattern} format`),f.pattern(e)(t)}return null}static \u0275fac=function(e){return new(e||i)(S(ne))};static \u0275dir=le({type:i,selectors:[["","crinput",""]],inputs:{min:"min",max:"max",minlength:"minlength",maxlength:"maxlength",block:"block",pattern:"pattern",crpattern:"crpattern",email:"email",validator:"validator",params:"params"},exportAs:["crinput"],features:[F([{provide:be,multi:!0,useExisting:i}])]})};var ot=["modal"];function rt(i,t){if(i&1&&(n(0,"option",20),m(1),r()),i&2){let e=t.$implicit;de("value",e.key),a(),C(" ",e.value," ")}}function nt(i,t){if(i&1&&(n(0,"option",20),m(1),r()),i&2){let e=t.$implicit;l("value",e.id),a(),C(" ",e.name," ")}}function at(i,t){if(i&1&&(n(0,"option",20),m(1),r()),i&2){let e=t.$implicit;l("value",e.id),a(),C(" ",e.name," ")}}function lt(i,t){if(i&1){let e=w();n(0,"div",3)(1,"form",4)(2,"div",5)(3,"label",6),m(4,"Coupon Code"),r(),c(5,"input",7),r(),n(6,"div",5)(7,"label",6),m(8,"Coupon Type"),r(),n(9,"select",8)(10,"option",9),m(11,"Select"),r(),p(12,rt,2,2,"option",10),D(13,"keyvalue"),r()(),n(14,"div",5)(15,"label",6),m(16,"Coupon Value"),r(),c(17,"input",11),r(),n(18,"div",5)(19,"label",6),m(20,"Cart Value"),r(),c(21,"input",12),r(),n(22,"div",5)(23,"label",6),m(24,"No of times coupon can be used"),r(),c(25,"input",13),r(),n(26,"div",5)(27,"label",6),m(28,"Expiry Date"),r(),c(29,"input",14),r(),n(30,"div",5)(31,"label",6),m(32,"Categories"),r(),n(33,"select",15),p(34,nt,2,2,"option",10),r()(),n(35,"div",5)(36,"label",6),m(37,"Brands"),r(),n(38,"select",16),p(39,at,2,2,"option",10),r()(),n(40,"div",17)(41,"button",18),b("click",function(){h(e);let s=d(2);return g(s.closeMe())}),m(42," Close "),r(),n(43,"button",19),b("click",function(){h(e);let s=d(2);return g(s.save())}),m(44),r()()()()}if(i&2){let e=d().ngIf,o=d();a(),l("formGroup",o.form),a(11),l("ngForOf",V(13,9,o.CouponTypeEnum)),a(22),l("ngForOf",e.categories),a(5),l("ngForOf",e.brands),a(4),me("btn ",o.saveButtonClass,""),l("disabled",o.saveButtonDisabled),a(),C(" ",o.saveButtonText," ")}}function st(i,t){if(i&1&&(n(0,"div",1),p(1,lt,45,11,"div",2),r()),i&2){let e=d();a(),l("ngIf",e.form)}}var R=class i extends je{constructor(e){super();this.fb=e}content;form;_lookupStore=I(Oe);lookupVm$=this._lookupStore.vm$;_formStore=I(L);ngOnInit(){this.initializeForm(),this._lookupStore.getCategories(),this._lookupStore.getBrands(),this.formData?.id&&this.patchForm()}save(){if(this.form?.valid){let e={code:this.form.value.code,type:this.form.value.type,value:this.form.value.value,cart_value:this.form.value.cart_value,usages:this.form.value.usages,expires_at:this.form.value.expires_at,categories:this.form.value.categories,brands:this.form.value.brands};this.form.value.id&&(e.id=this.form.value.id),this._formStore.saveData(e).subscribe(o=>{this.confirm()})}}patchForm(){this.form?.patchValue({id:this.formData.id,code:this.formData.code,type:this.formData.type,value:this.formData.value,cart_value:this.formData.cart_value,usages:this.formData.usages,expires_at:this.formData.expires_at,categories:this.formData.categories.map(e=>e.id),brands:this.formData.brands.map(e=>e.id)})}initializeForm(){this.form=this.fb.group({id:new _(null),code:new _("",[f.required]),type:new _("",[f.required]),value:new _("",[f.required]),cart_value:new _("",[f.required]),usages:new _(1),expires_at:new _(null,ze),categories:new _(""),brands:new _("")})}CouponTypeEnum=Y;static \u0275fac=function(o){return new(o||i)(S(Ve))};static \u0275cmp=P({type:i,selectors:[["app-form"]],viewQuery:function(o,s){if(o&1&&ue(ot,5),o&2){let u;fe(u=_e())&&(s.content=u.first)}},standalone:!1,features:[F([L]),se],decls:2,vars:3,consts:[["class","card p-3",4,"ngIf"],[1,"card","p-3"],["class","card-body",4,"ngIf"],[1,"card-body"],["admin-form","","method","POST",3,"formGroup"],[1,"mb-3"],["for","exampleInputEmail1",1,"form-label"],["type","text","id","code","name","code","placeholder","Code","formControlName","code",1,"form-control"],["name","type","formControlName","type",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","id","name","name","value","placeholder","Value","formControlName","value",1,"form-control"],["type","text","id","cart_value","name","cart_value","placeholder","Cart Value","formControlName","cart_value",1,"form-control"],["type","text","id","usages","name","usages","placeholder","Usages","formControlName","usages",1,"form-control"],["crinput","","validator","future","type","date","id","expires_at","name","expires_at","formControlName","expires_at",1,"form-control"],["multiple","","name","categories[]","formControlName","categories",1,"form-select"],["multiple","","name","brands[]","formControlName","brands",1,"form-select"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","submit",3,"click","disabled"],[3,"value"]],template:function(o,s){o&1&&(p(0,st,2,1,"div",0),D(1,"async")),o&2&&l("ngIf",V(1,1,s.lookupVm$))},dependencies:[H,q,Pe,Ae,Se,Ie,De,Ce,Te,we,xe,ye,Fe,Ee,Z,U,ve],encapsulation:2})};function mt(i,t){if(i&1&&(n(0,"div",15),m(1),r()),i&2){let e=t.$implicit;a(),C(" ",e.name," ")}}function pt(i,t){if(i&1&&p(0,mt,2,1,"div",14),i&2){let e=t.item;l("ngForOf",e.brands)}}function ct(i,t){if(i&1&&(n(0,"div",15),m(1),r()),i&2){let e=t.$implicit;a(),C(" ",e.name," ")}}function dt(i,t){if(i&1&&p(0,ct,2,1,"div",14),i&2){let e=t.item;l("ngForOf",e.categories)}}function ut(i,t){if(i&1){let e=w();n(0,"div",16)(1,"button",17),c(2,"i",18),r(),n(3,"ul",19)(4,"li")(5,"a",20),b("click",function(){let s=h(e).item,u=d(2);return g(u.edit(s))}),c(6,"i",21),m(7," Edit "),r()(),n(8,"li")(9,"a",22),b("click",function(){let s=h(e).item,u=d(2);return g(u.delete(s))}),c(10,"i",23),m(11," Delete "),r()()()()}}function ft(i,t){if(i&1){let e=w();pe(0),n(1,"app-table",4),b("addButton",function(s){h(e);let u=d();return g(u.add(s))})("reload",function(){h(e);let s=d();return g(s.reload())})("changePage",function(s){h(e);let u=d();return g(u.pageChanged(s))}),c(2,"data-table-column",5)(3,"data-table-column",6)(4,"data-table-column",7),n(5,"data-table-column",8),p(6,pt,1,1,"ng-template",null,2,G),r(),n(8,"data-table-column",9),p(9,dt,1,1,"ng-template",null,2,G),r(),c(11,"data-table-column",10)(12,"data-table-column",11)(13,"data-table-column",12),n(14,"data-table-column",13),p(15,ut,12,0,"ng-template",null,2,G),r()(),ce()}if(i&2){let e=t.ngIf;a(),l("indexColumn",!1)("sortBy",e.filter==null?null:e.filter.sortBy)("sortDir",e.filter==null?null:e.filter.sortDir)("itemCount",e.data==null?null:e.data.total)("items",e.data==null?null:e.data.data)("searchText",e.filter==null?null:e.filter.searchText)("page",e.filter==null?null:e.filter.page),a(),l("sortable",!0),a(),l("sortable",!0),a(),l("sortable",!0),a(),l("sortable",!1),a(3),l("sortable",!1),a(3),l("sortable",!0),a(),l("sortable",!0),a(),l("sortable",!0),a(),l("sortable",!1)}}var K=class i{constructor(t){this.modalService=t}_store=I(N);vm$=this._store.vm$;ngOnInit(){this._store.loadData(this._store.filter$)}delete=t=>oe(this,null,function*(){this.modalService.openConfirmationModal({modalTitle:"Are you sure?",modalBody:"click confirm or close"}).subscribe(e=>{this._store.delete(t.id),this._store.reset()})});edit(t){this.modalService.openModal(R,t,{modalTitle:"Edit Coupon"}).subscribe(e=>{this._store.reset()})}add(t){t.preventDefault(),this.modalService.openModal(R,null,{modalTitle:"Create Coupon"}).subscribe(e=>{this._store.reset()})}pageChanged(t){let e=[];e.push({column:"code",value:Re(t),operator:"like"}),t=O(j({},t),{searchFilters:e}),this._store.updateFilter(t)}reload(){this._store.reset()}static \u0275fac=function(e){return new(e||i)(S(Be))};static \u0275cmp=P({type:i,selectors:[["app-coupon-list"]],standalone:!1,features:[F([N])],decls:6,vars:3,consts:[["confirmationModal",""],["modal",""],["dataTableCell",""],[4,"ngIf"],["headerTitle","Coupons",3,"addButton","reload","changePage","indexColumn","sortBy","sortDir","itemCount","items","searchText","page"],["header","#","property","id",3,"sortable"],["header","Code","property","code",3,"sortable"],["header","Type","property","type",3,"sortable"],["header","Brands",3,"sortable"],["header","Categories",3,"sortable"],["header","Value","property","value",3,"sortable"],["header","Cart Value","property","cart_value",3,"sortable"],["header","Expires At","property","expires_at",3,"sortable"],["header","Action",3,"sortable"],["class","d-flex align-items-center justify-content-between",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown","aria-expanded","false","aria-label","Settings",1,"btn","btn-icon","btn-ghost","rounded-circle"],[1,"fa-solid","fa-ellipsis-vertical",2,"font-size","22px"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0)",1,"dropdown-item",3,"click"],[1,"fa","fa-edit","opacity-75","me-2"],["href","javascript:void(0)",1,"dropdown-item","text-danger",3,"click"],[1,"fa","fa-trash","opacity-75","me-2"]],template:function(e,o){e&1&&(p(0,ft,17,16,"ng-container",3),D(1,"async"),c(2,"div",null,0)(4,"div",null,1)),e&2&&l("ngIf",V(1,1,o.vm$))},dependencies:[H,q,He,Ge,U],encapsulation:2})};var _t=[{path:"",component:K}],J=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=A({type:i});static \u0275inj=B({imports:[X.forChild(_t),X]})};var Je=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=A({type:i});static \u0275inj=B({imports:[he,J,qe,Ue,Me]})};export{Je as CouponsModule};
